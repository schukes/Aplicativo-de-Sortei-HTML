<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <title>Sorteio Corporativo - Tela Cheia</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap');

        :root {
            --cor-primaria: #388E3C;
            --cor-secundaria: #66BB6A;
            --cor-fundo: #E8F5E9;
            --cor-texto: #2E3A42;
            --cor-fundo-card: #ffffff;
            --cor-excluir: #E53935;
            --cor-aviso: #FF9800;
            --cor-imprimir: #42A5F5;
            --cor-continuar: #4CAF50;
            --cor-borda: #C8E6C9;
        }

        body.tema-escuro {
            --cor-primaria: #1B5E20;
            --cor-secundaria: #43A047;
            --cor-fundo: #102117;
            --cor-texto: #E0E0E0;
            --cor-fundo-card: #1E2722;
            --cor-borda: #2E7D32;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, var(--cor-secundaria), var(--cor-primaria));
            color: var(--cor-texto);
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: var(--cor-fundo-card);
            padding: 25px 30px;
            border-radius: 18px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25);
            max-width: 1100px;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .topo {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
        }

        h1 {
            margin: 0;
            font-weight: 900;
            color: var(--cor-primaria);
            border-bottom: 3px solid var(--cor-secundaria);
            padding-bottom: 8px;
        }

        .btn-tema {
            padding: 8px 16px;
            border-radius: 20px;
            border: none;
            cursor: pointer;
            font-weight: 700;
            background: var(--cor-primaria);
            color: #fff;
        }

        .progress-container {
            margin-top: 8px;
            background: var(--cor-fundo);
            border-radius: 10px;
            border: 1px solid var(--cor-borda);
            overflow: hidden;
            position: relative;
            height: 20px;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--cor-secundaria), var(--cor-primaria));
            transition: width 0.3s ease;
        }

        .progress-label {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
            color: #1b1b1b;
        }

        .content-wrapper {
            display: flex;
            gap: 20px;
        }

        .lista-secao {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        h2 {
            font-size: 1.1em;
            margin: 0 0 8px;
            color: var(--cor-primaria);
            font-weight: 700;
        }

        .lista-box {
            background: var(--cor-fundo);
            border: 1px solid var(--cor-secundaria);
            border-radius: 10px;
            padding: 8px 12px;
            font-size: 14px;
            color: var(--cor-texto);
            height: 200px;
            overflow-y: auto;
            text-align: left;
            user-select: none;
            flex-grow: 1;
        }

        .lista-box ul { list-style: none; margin: 0; padding: 0; }

        .lista-box li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 0;
            border-bottom: 1px dashed #ccc;
        }

        .lista-box li:last-child { border-bottom: none; }

        .btn-excluir {
            background: none;
            border: none;
            color: var(--cor-excluir);
            font-weight: 700;
            cursor: pointer;
            font-size: 0.9em;
            padding: 0 5px;
        }

        .input-area {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .input-area input[type="text"] {
            flex: 1;
            padding: 8px 10px;
            font-size: 14px;
            border-radius: 8px;
            border: 1px solid #ccc;
            outline: none;
        }
        
        .input-area input[type="file"] {
            /* Estilo para garantir que o input de arquivo funcione bem */
            line-height: 24px; 
        }

        .input-area button,
        button.btn-acao {
            color: white;
            border: none;
            padding: 10px 18px;
            font-size: 14px;
            font-weight: 700;
            border-radius: 50px;
            cursor: pointer;
        }
        
        /* COR AZUL PARA O BOT√ÉO ADICIONAR */
        #btnAdicionar {
            background-color: var(--cor-imprimir); 
        }

        #btnSortear {
            background-color: var(--cor-primaria);
            font-size: 18px;
        }

        #btnImprimirSorteados { background-color: var(--cor-imprimir); }
        #btnResetarSorteados { background-color: var(--cor-aviso); }
        #btnLimparSorteados { background-color: var(--cor-excluir); }
        #btnExportarCSV { background-color: var(--cor-continuar); }

        .area-botoes-principais {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .resultado {
            margin-top: 6px;
            font-size: 14px;
            font-weight: 700;
            text-align: center;
        }

        .linha-auto {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 13px;
            margin-top: 4px;
        }

        .linha-auto input[type="number"] {
            width: 60px;
            padding: 4px;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

        .log-box {
            margin-top: 10px;
            font-size: 12px;
            max-height: 120px;
            overflow-y: auto;
            border-top: 1px dashed #ccc;
            padding-top: 6px;
        }

        .log-box ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .log-box li {
            padding: 2px 0;
        }

        /* --- TELA CHEIA (AJUSTES) --- */
        #tela-cheia-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            background: radial-gradient(circle at top, #1b5e20 0, #000 60%);
            z-index: 9999;
            color: #fff;
            text-align: center;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .overlay-inner {
            /* Ajustado ap√≥s remover a sidebar */
            display: block; 
            width: 90vw;
            max-width: 1400px;
            gap: 20px;
        }

        .overlay-main {
            /* Ajustado para ocupar o espa√ßo total */
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #texto-sorteio-fullscreen {
            font-size: 7vw;
            font-weight: 900;
            padding: 20px;
            line-height: 1.1;
            text-shadow: 0 0 25px rgba(102, 187, 106, 0.9);
        }
        
        /* NOVA ANIMA√á√ÉO DE FADE/PISCADA */
        .animacao-sorteio-fs {
            animation: fadeRoll 0.1s linear infinite;
        }

        @keyframes fadeRoll {
            0%   { opacity: 0.2; }
            50%  { opacity: 1; }
            100% { opacity: 0.2; }
        }

        .zoom-vencedor {
            animation: zoomWinner 0.8s ease-out forwards;
        }

        @keyframes zoomWinner {
            0% { transform: scale(0.8); opacity: 0.3; }
            60% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); }
        }

        .btn-fechar-overlay {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 2px solid white;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            font-size: 22px;
            cursor: pointer;
            display: none;
        }

        .subtitulo-overlay {
            font-size: 1.6vw;
            color: #C8E6C9;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 4px;
        }

        .contador-overlay {
            font-size: 1vw;
            color: #A5D6A7;
            margin-bottom: 10px;
        }

        .instrucao-overlay {
            margin-top: 12px;
            font-size: 0.9vw;
            color: #c8e6c9;
            font-weight: 700;
            display: none;
        }

        .botoes-overlay {
            margin-top: 12px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .btn-overlay-acao {
            padding: 8px 18px;
            border-radius: 20px;
            border: none;
            cursor: pointer;
            font-weight: 700;
        }

        #btnProximoOverlay {
            background: #43A047;
            color: #fff;
        }

        #btnProximoOverlay:disabled {
            background: #2e7d32;
            opacity: 0.5;
            cursor: not-allowed;
        }

        #btnPararAutoOverlay {
            background: #E53935;
            color: #fff;
        }

        @media print {
            body > *:not(.print-container) { display: none; }
            .print-container {
                display: block !important;
                position: absolute;
                left: 0; top: 0; width: 100%;
                margin: 0; padding: 20px;
                background-color: white; color: black;
                font-family: 'Arial', sans-serif;
            }
            .print-container h1 { border-bottom: 2px solid #ccc; padding-bottom: 10px; font-size: 24pt; }
            .print-container li { padding: 5px 0; border-bottom: 1px dotted #ccc; font-size: 14pt; }
        }
    </style>
</head>
<body>

    <div id="tela-cheia-overlay">
        <button class="btn-fechar-overlay" id="btnFecharOverlay">‚úï</button>

        <div class="overlay-inner">
            <div class="overlay-main">
                <div class="subtitulo-overlay" id="subtitulo-overlay">Sorteando...</div>
                <div class="contador-overlay" id="contadorOverlay"></div>
                <div id="texto-sorteio-fullscreen">Nome</div>
                <div class="botoes-overlay">
                    <button id="btnProximoOverlay" class="btn-overlay-acao">Pr√≥ximo</button>
                    <button id="btnPararAutoOverlay" class="btn-overlay-acao" style="display:none;">Parar Auto</button>
                </div>
                <div class="instrucao-overlay" id="instrucaoContinuar">Aperte ESPA√áO para o pr√≥ximo sorteio.</div>
            </div>

            </div>
    </div>

    <div class="container">
        <div class="topo">
            <h1>üèÜ Sorteio Corporativo</h1>
            <button id="btnTema" class="btn-tema">Alternar Tema Claro/Escuro</button>
        </div>

        <div class="progress-container">
            <div id="progressBar" class="progress-bar"></div>
            <div id="progressLabel" class="progress-label">0 / 0 sorteados</div>
        </div>

        <div class="content-wrapper">
            <div class="lista-secao">
                <h2>Candidatos (Total: <span id="contadorCandidatos"></span>)</h2>
                <div class="lista-box" id="listaNomes"></div>

                <div class="input-area">
                    <input type="text" id="novoNome" placeholder="Adicionar novo nome" />
                    <button id="btnAdicionar">Adicionar</button>
                </div>
                
                <div class="input-area" style="margin-top: 10px;">
                    <input type="file" id="arquivoNomes" accept=".txt, .csv" style="flex: 1; padding: 4px;"/>
                    <button id="btnImportar" class="btn-acao" style="background-color: var(--cor-secundaria);">Importar Lista</button>
                    <button id="btnLimparCandidatos" class="btn-acao" style="background-color: var(--cor-excluir);">üóëÔ∏è Limpar Candidatos</button>
                </div>
                </div>

            <div class="lista-secao">
                <h2>Sorteados (Vencedores)</h2>
                <div class="lista-box" id="listaSorteados"></div>
            </div>
        </div>

        <div class="area-botoes-principais">
            <button id="btnSortear" class="btn-acao">INICIAR SORTEIO EM TELA CHEIA</button>
            <button id="btnImprimirSorteados" class="btn-acao">üñ®Ô∏è Imprimir Vencedores</button>
            <button id="btnExportarCSV" class="btn-acao">üìÑ Exportar CSV</button>
            <button id="btnResetarSorteados" class="btn-acao">‚Ü©Ô∏è Voltar Nomes p/ Sorteio</button>
            <button id="btnLimparSorteados" class="btn-acao">Excluir Sorteados</button>
        </div>

        <div class="linha-auto">
            <label>
                <input type="checkbox" id="chkAuto" />
                Modo autom√°tico (sorteia at√© acabar)
            </label>
            <label>
                Intervalo (segundos):
                <input type="number" id="intervaloAuto" min="1" max="60" value="5" />
            </label>
        </div>

        <div class="resultado" id="resultado">Aguardando in√≠cio...</div>

        <div class="log-box">
            <strong>Log de sorteios (data/hora):</strong>
            <ul id="logSorteios"></ul>
        </div>
    </div>

    <div class="print-container" style="display:none;"></div>

    <script>
        // Persist√™ncia
        function carregarJSON(key, def) {
            try {
                const d = localStorage.getItem(key);
                return d ? JSON.parse(d) : def;
            } catch {
                return def;
            }
        }
        function salvarJSON(key, value) {
            try {
                localStorage.setItem(key, JSON.stringify(value));
            } catch { }
        }

        let nomes = carregarJSON('sorteio_candidatos', [
            "Felipe Martins", "Tiago Guedes", "Leticia", "Rodrigo", "Isadora",
            "Camila Beatriz", "Fernando", "Tiago Hasegawa", "Yasmim"
        ]);
        let nomesSorteados = carregarJSON('sorteio_sorteados', []);
        let logSorteios = carregarJSON('sorteio_log', []);

        let isSorteando = false;
        let autoMode = false;
        let autoTimeoutId = null;

        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        // DOM principais
        const listaNomesEl = document.getElementById('listaNomes');
        const listaSorteadosEl = document.getElementById('listaSorteados');
        const contadorCandidatosEl = document.getElementById('contadorCandidatos');
        const resultadoEl = document.getElementById('resultado');
        const novoNomeInput = document.getElementById('novoNome');
        
        // DOM NOVOS
        const arquivoNomesInput = document.getElementById('arquivoNomes');
        const btnImportar = document.getElementById('btnImportar');
        const btnLimparCandidatos = document.getElementById('btnLimparCandidatos'); // NOVO BOT√ÉO

        const overlayEl = document.getElementById('tela-cheia-overlay');
        const textoFullscreenEl = document.getElementById('texto-sorteio-fullscreen');
        const btnFecharOverlayEl = document.getElementById('btnFecharOverlay');
        const subtituloOverlayEl = document.getElementById('subtitulo-overlay');
        const instrucaoContinuarEl = document.getElementById('instrucaoContinuar');
        const contadorOverlayEl = document.getElementById('contadorOverlay');
        const btnProximoOverlay = document.getElementById('btnProximoOverlay');
        const btnPararAutoOverlay = document.getElementById('btnPararAutoOverlay');

        const btnSortear = document.getElementById('btnSortear');
        const btnAdicionar = document.getElementById('btnAdicionar');
        const btnLimparSorteados = document.getElementById('btnLimparSorteados');
        const btnImprimirSorteados = document.getElementById('btnImprimirSorteados');
        const btnResetarSorteados = document.getElementById('btnResetarSorteados');
        const btnExportarCSV = document.getElementById('btnExportarCSV');
        const btnTema = document.getElementById('btnTema');
        const chkAuto = document.getElementById('chkAuto');
        const intervaloAutoInput = document.getElementById('intervaloAuto');

        const progressBarEl = document.getElementById('progressBar');
        const progressLabelEl = document.getElementById('progressLabel');
        const logSorteiosEl = document.getElementById('logSorteios');

        function getTotalAtual() {
            return nomes.length + nomesSorteados.length;
        }

        // Sons
        function playClickBeep(delay = 0) {
            if (audioContext.state === 'suspended') return;
            const osc = audioContext.createOscillator();
            const g = audioContext.createGain();
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(850, audioContext.currentTime + delay);
            g.gain.setValueAtTime(0.3, audioContext.currentTime + delay);
            g.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + delay + 0.05);
            osc.connect(g); g.connect(audioContext.destination);
            osc.start(audioContext.currentTime + delay);
            osc.stop(audioContext.currentTime + delay + 0.05);
        }

        function playWinnerMelody() {
            if (audioContext.state === 'suspended') return;
            const seq = [
                { f: 523.25, d: 0.12 }, { f: 659.25, d: 0.12 },
                { f: 783.99, d: 0.15 }, { f: 987.77, d: 0.2 },
                { f: 1174.66, d: 0.25 }
            ];
            let t = audioContext.currentTime;
            seq.forEach(({ f, d }, i) => {
                const osc = audioContext.createOscillator();
                const g = audioContext.createGain();
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(f, t);
                g.gain.setValueAtTime(0.18, t);
                g.gain.exponentialRampToValueAtTime(0.0001, t + d);
                osc.connect(g); g.connect(audioContext.destination);
                osc.start(t);
                osc.stop(t + d);
                t += d * 0.9;
            });

            // "batida" grave
            const bass = audioContext.createOscillator();
            const gb = audioContext.createGain();
            bass.type = 'sine';
            bass.frequency.setValueAtTime(110, audioContext.currentTime);
            gb.gain.setValueAtTime(0.4, audioContext.currentTime);
            gb.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.4);
            bass.connect(gb); gb.connect(audioContext.destination);
            bass.start();
            bass.stop(audioContext.currentTime + 0.4);
        }

        // Auxiliares
        function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

        function atualizarProgresso() {
            const total = getTotalAtual();
            const sorteados = nomesSorteados.length;
            const pct = total > 0 ? (sorteados / total) * 100 : 0;
            progressBarEl.style.width = pct + '%';
            progressLabelEl.textContent = `${sorteados} / ${total} sorteados`;
        }

        function atualizarLogVisual() {
            logSorteiosEl.innerHTML = '';
            logSorteios.forEach(item => {
                const li = document.createElement('li');
                li.textContent = `${item.ordem}¬∫ - ${item.nome} (${item.dataHora})`;
                logSorteiosEl.appendChild(li);
            });
        }

        function atualizarLista() {
            nomes.sort((a, b) => a.toLowerCase().localeCompare(b.toLowerCase()));
            const ulNomes = document.createElement('ul');
            nomes.forEach(nome => {
                const li = document.createElement('li');
                li.innerHTML = `<span>${nome}</span><button class="btn-excluir" data-nome="${nome}">X</button>`;
                ulNomes.appendChild(li);
            });
            listaNomesEl.innerHTML = '';
            listaNomesEl.appendChild(ulNomes);

            document.querySelectorAll('.btn-excluir').forEach(btn => {
                btn.addEventListener('click', () => removerNome(btn.getAttribute('data-nome')));
            });

            const ulSorteados = document.createElement('ul');
            nomesSorteados.forEach((nome, index) => {
                const li = document.createElement('li');
                li.textContent = `${nomesSorteados.length - index}¬∫: ${nome}`;
                ulSorteados.appendChild(li);
            });
            listaSorteadosEl.innerHTML = '';
            listaSorteadosEl.appendChild(ulSorteados);

            contadorCandidatosEl.textContent = nomes.length;

            salvarJSON('sorteio_candidatos', nomes);
            salvarJSON('sorteio_sorteados', nomesSorteados);
            salvarJSON('sorteio_log', logSorteios);

            atualizarProgresso();
            atualizarLogVisual();
        }

        // Tela cheia
        function abrirTelaCheia() {
            overlayEl.style.display = 'flex';
            btnFecharOverlayEl.style.display = 'none';
            instrucaoContinuarEl.style.display = 'none';
            btnProximoOverlay.disabled = true;
            btnPararAutoOverlay.style.display = autoMode ? 'inline-block' : 'none';

            if (document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen().catch(() => { });
            }
        }

        function fecharTelaCheia() {
            overlayEl.style.display = 'none';
            if (document.exitFullscreen && document.fullscreenElement) {
                document.exitFullscreen();
            }
            cancelarAuto();
        }

        function lancarConfetti() {
            const cfg = { startVelocity: 40, spread: 360, ticks: 100, zIndex: 10000, colors: ['#66BB6A', '#388E3C', '#FFFFFF', '#FFEB3B'] };
            confetti(Object.assign({}, cfg, { particleCount: 120, origin: { y: 0.6 } }));
            setTimeout(() => confetti(Object.assign({}, cfg, { particleCount: 120, origin: { y: 0.6 } })), 400);
        }

        async function realizarRodadaDeSorteio() {
            if (nomes.length === 0) {
                textoFullscreenEl.textContent = "FIM";
                subtituloOverlayEl.textContent = "Todos os candidatos foram sorteados!";
                instrucaoContinuarEl.style.display = 'none';
                btnFecharOverlayEl.style.display = 'block';
                btnProximoOverlay.disabled = true;
                btnPararAutoOverlay.style.display = 'none';
                isSorteando = false;
                cancelarAuto();
                return;
            }

            isSorteando = true;
            textoFullscreenEl.classList.remove('zoom-vencedor');
            textoFullscreenEl.style.color = '#ffffff';
            textoFullscreenEl.classList.add('animacao-sorteio-fs');

            const total = getTotalAtual();
            const proximoNumero = nomesSorteados.length + 1;
            subtituloOverlayEl.textContent = `Sorteando o ${proximoNumero}¬∫ vencedor...`;
            contadorOverlayEl.textContent = `Sorteio ${proximoNumero} de ${total}`;

            instrucaoContinuarEl.style.display = 'none';
            btnFecharOverlayEl.style.display = 'none';
            btnProximoOverlay.disabled = true;

            const ciclos = 30 + Math.floor(Math.random() * 20);
            const indiceFinal = Math.floor(Math.random() * nomes.length);

            // C√ìDIGO PARA ANIMA√á√ÉO ALEAT√ìRIA
            for (let i = 0; i < ciclos; i++) {
                const indiceAleatorio = Math.floor(Math.random() * nomes.length); 
                playClickBeep();
                textoFullscreenEl.textContent = nomes[indiceAleatorio];
                await sleep(50 + Math.pow(i / ciclos, 3) * 280);
            }
            // FIM DO C√ìDIGO ALEAT√ìRIO

            const nomeVencedor = nomes[indiceFinal];
            textoFullscreenEl.classList.remove('animacao-sorteio-fs');
            textoFullscreenEl.textContent = nomeVencedor;
            textoFullscreenEl.style.color = '#66BB6A';
            textoFullscreenEl.classList.add('zoom-vencedor');

            subtituloOverlayEl.textContent = "üéâ VENCEDOR(A) üéâ";

            playWinnerMelody();
            lancarConfetti();

            nomesSorteados.unshift(nomes.splice(indiceFinal, 1)[0]);
            resultadoEl.textContent = `√öltimo sorteado: ${nomeVencedor}`;

            const agora = new Date();
            logSorteios.unshift({
                ordem: nomesSorteados.length,
                nome: nomeVencedor,
                dataHora: agora.toLocaleString('pt-BR')
            });

            atualizarLista();

            const totalNovo = getTotalAtual();
            contadorOverlayEl.textContent = `Sorteio ${nomesSorteados.length} de ${totalNovo}`;

            isSorteando = false;
            btnFecharOverlayEl.style.display = 'block';

            if (nomes.length > 0) {
                instrucaoContinuarEl.textContent = `Aperte ESPA√áO ou clique em "Pr√≥ximo" para o ${nomesSorteados.length + 1}¬∫ sorteio.`;
                instrucaoContinuarEl.style.display = 'block';
                btnProximoOverlay.disabled = false;

                if (autoMode) {
                    agendarAuto();
                    btnPararAutoOverlay.style.display = 'inline-block';
                }
            } else {
                instrucaoContinuarEl.style.display = 'none';
                btnProximoOverlay.disabled = true;
                btnPararAutoOverlay.style.display = 'none';
                cancelarAuto();
            }
        }

        async function iniciarSorteio() {
            if (getTotalAtual() === 0 || nomes.length === 0) {
                alert('Adicione candidatos antes de iniciar.');
                return;
            }
            if (audioContext.state === 'suspended') audioContext.resume();
            abrirTelaCheia();
            await realizarRodadaDeSorteio();
        }

        async function continuarSorteioFS() {
            if (isSorteando) return;
            btnFecharOverlayEl.style.display = 'none';
            btnProximoOverlay.disabled = true;
            await realizarRodadaDeSorteio();
        }

        // Auto
        function agendarAuto() {
            cancelarAuto();
            const seg = parseInt(intervaloAutoInput.value, 10) || 5;
            autoTimeoutId = setTimeout(() => {
                if (overlayEl.style.display === 'flex' && nomes.length > 0 && !isSorteando) {
                    continuarSorteioFS();
                }
            }, seg * 1000);
        }

        function cancelarAuto() {
            if (autoTimeoutId) {
                clearTimeout(autoTimeoutId);
                autoTimeoutId = null;
            }
        }

        // CRUD nomes
        function adicionarNome() {
            let n = novoNomeInput.value.trim();
            if (!n) return alert('Digite um nome v√°lido.');
            n = n.toLowerCase().split(' ').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
            if (nomes.includes(n) || nomesSorteados.includes(n)) return alert('Nome j√° existe.');
            nomes.push(n);
            novoNomeInput.value = '';
            atualizarLista();
        }
        
        // FUN√á√ÉO DE IMPORTA√á√ÉO DE NOMES
        function importarNomes() {
            const arquivo = arquivoNomesInput.files[0];
            if (!arquivo) return alert('Selecione um arquivo .txt ou .csv com nomes em cada linha.');

            const leitor = new FileReader();
            
            leitor.onload = function(e) {
                const conteudo = e.target.result;
                const novosNomes = conteudo.split(/\r?\n/).map(n => n.trim()).filter(n => n.length > 0);
                let nomesAdicionados = 0;
                let nomesExistentes = 0;

                novosNomes.forEach(n => {
                    let nomeNormalizado = n.toLowerCase().split(' ').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');

                    if (nomes.includes(nomeNormalizado) || nomesSorteados.includes(nomeNormalizado)) {
                        nomesExistentes++;
                    } else {
                        nomes.push(nomeNormalizado);
                        nomesAdicionados++;
                    }
                });

                if (nomesAdicionados > 0) {
                    alert(`${nomesAdicionados} nomes importados com sucesso!\n${nomesExistentes} nomes ignorados (j√° existiam ou estavam vazios).`);
                    arquivoNomesInput.value = ''; // Limpa o campo
                    atualizarLista();
                } else {
                    alert(`Nenhum novo nome foi adicionado. ${nomesExistentes} nomes j√° existiam na lista.`);
                }
            };

            leitor.onerror = function() {
                alert('Erro ao ler o arquivo.');
            };

            leitor.readAsText(arquivo);
        }
        // FIM FUN√á√ÉO IMPORTA√á√ÉO

        // NOVA FUN√á√ÉO PARA LIMPAR TODOS OS CANDIDATOS
        function limparCandidatos() {
            if (nomes.length === 0) return alert("Lista de candidatos j√° est√° vazia.");
            if (!confirm("Tem certeza que deseja apagar TODOS os candidatos?")) return;
            
            nomes = [];
            atualizarLista();
            resultadoEl.textContent = 'Lista de candidatos limpa.';
        }
        // FIM NOVA FUN√á√ÉO

        function removerNome(n) {
            if (!confirm(`Remover "${n}"?`)) return;
            nomes = nomes.filter(x => x !== n);
            atualizarLista();
        }

        function limparSorteados() {
            if (nomesSorteados.length === 0) return alert("Lista de sorteados vazia.");
            if (!confirm("Limpar lista de vencedores? (Os nomes ser√£o perdidos do hist√≥rico de vencedores)")) return;
            nomesSorteados = [];
            atualizarLista();
        }

        function resetarSorteadosParaCandidatos() {
            if (nomesSorteados.length === 0) return alert("Lista de sorteados vazia.");
            if (!confirm("Voltar os sorteados para a lista de candidatos?")) return;
            nomes = nomes.concat(nomesSorteados);
            nomesSorteados = [];
            atualizarLista();
        }

        // Impress√£o e CSV
        function imprimirSorteados() {
            if (nomesSorteados.length === 0) return alert("Nada para imprimir.");
            let html = `<h1>Vencedores</h1><ul>`;
            nomesSorteados.forEach((n, i) => html += `<li>${nomesSorteados.length - i}¬∫: ${n}</li>`);
            html += `</ul>`;
            const pc = document.querySelector('.print-container');
            pc.innerHTML = html;
            pc.style.display = 'block';
            window.print();
            pc.style.display = 'none';
        }

        function exportarCSV() {
            if (nomesSorteados.length === 0) {
                alert('Nenhum vencedor para exportar.');
                return;
            }
            let linhas = ['ordem;nome;data_hora'];
            logSorteios
                .sort((a, b) => a.ordem - b.ordem)
                .forEach(l => {
                    linhas.push(`${l.ordem};"${l.nome.replace(/"/g, '""')}";"${l.dataHora}"`);
                });
            const csv = linhas.join('\r\n');
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'vencedores_sorteio.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Tema
        btnTema.addEventListener('click', () => {
            document.body.classList.toggle('tema-escuro');
        });

        // Eventos
        btnSortear.addEventListener('click', iniciarSorteio);
        btnAdicionar.addEventListener('click', adicionarNome);
        novoNomeInput.addEventListener('keyup', e => { if (e.key === 'Enter') adicionarNome(); });
        
        // EVENTOS NOVOS
        btnImportar.addEventListener('click', importarNomes);
        btnLimparCandidatos.addEventListener('click', limparCandidatos); // NOVO EVENTO

        btnLimparSorteados.addEventListener('click', limparSorteados);
        btnImprimirSorteados.addEventListener('click', imprimirSorteados);
        btnResetarSorteados.addEventListener('click', resetarSorteadosParaCandidatos);
        btnExportarCSV.addEventListener('click', exportarCSV);

        chkAuto.addEventListener('change', () => {
            autoMode = chkAuto.checked;
            if (!autoMode) {
                cancelarAuto();
                btnPararAutoOverlay.style.display = 'none';
            } else if (overlayEl.style.display === 'flex' && !isSorteando && nomes.length > 0) {
                agendarAuto();
                btnPararAutoOverlay.style.display = 'inline-block';
            }
        });

        intervaloAutoInput.addEventListener('change', () => {
            if (autoMode && overlayEl.style.display === 'flex') {
                agendarAuto();
            }
        });

        btnFecharOverlayEl.addEventListener('click', fecharTelaCheia);

        btnProximoOverlay.addEventListener('click', () => {
            if (!isSorteando && nomes.length > 0) {
                continuarSorteioFS();
            }
        });

        btnPararAutoOverlay.addEventListener('click', () => {
            autoMode = false;
            chkAuto.checked = false;
            cancelarAuto();
            btnPararAutoOverlay.style.display = 'none';
        });

        // Teclado
        document.addEventListener('keydown', async (e) => {
            if (
                overlayEl.style.display === 'flex' &&
                !isSorteando &&
                nomes.length > 0 &&
                e.code === 'Space'
            ) {
                e.preventDefault();
                await continuarSorteioFS();
                return;
            }

            if (overlayEl.style.display === 'flex' && e.key === 'Escape') {
                fecharTelaCheia();
            }
        });

        // Inicializa
        atualizarLista();
    </script>
</body>
</html>
